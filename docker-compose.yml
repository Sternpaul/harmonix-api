version: "3.3"
services:
  api:
    image: 'onyxapi:${TAG-latest}'
    env_file:
      - .env
    environment:
      - SERVER_NAME=${SERVER_NAME?Variable not set}
      - SERVER_HOST=${SERVER_HOST?Variable not set}
      # Allow explicit env var override for tests
      - CRONTAB="cat crontab"
      - TZ="UTC"
    ports:
      - "80:80"
    build:
      dockerfile: backend.dockerfile
      args:
        INSTALL_DEV: ${INSTALL_DEV-false}

  crontab:
    image: 'crontab_runner:${TAG-latest}'
    env_file:
      - .env
    environment:
      - SERVER_NAME=${SERVER_NAME?Variable not set}
      - SERVER_HOST=${SERVER_HOST?Variable not set}
      # Allow explicit env var override for tests
      - CRONTAB="cat crontab"
      - TZ="UTC"
    build:
      dockerfile: crontab.dockerfile
      args:
        INSTALL_DEV: ${INSTALL_DEV-false}